name: make-all

on:
  pull_request:
  push:
    branches:
      - master

jobs:
  make-all:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository content
      uses: actions/checkout@v2

    - name: Setup Python Version
      uses: actions/setup-python@v2
      with:
        python-version: 3.8
    - run: python -m pip install --upgrade pip wheel
    - run: python -m pip install -r code/requirements.txt

    - name: Execute the Makefile
      run: |
        make all
        make clean

    - name: Commit to orphan branch
      run: |
        git checkout --orphan gh-action-result/make-all
        git rm -rf .git
        git add *
        git -c user.name='GitHub Action' -c user.email='action@github.com' commit -m "Build current code/paper version"
